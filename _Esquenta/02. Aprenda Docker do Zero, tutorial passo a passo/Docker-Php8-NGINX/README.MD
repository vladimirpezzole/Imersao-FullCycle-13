## **02. Aprenda Docker do Zero, tutorial passo a passo**

[>> Video üéûÔ∏è](https://youtu.be/8MJWke19g8U)
*************
<hr>

### **Importante!!!** antes de continuar verifique se o **Docker** est√° instalado corretamente, caso precise instalar siga o tutorial: [**Instala√ß√£o do Docker e Docker Compose**](Como-Instalar-Docker-e-Docker-Compose.md)

<hr>

**************

### Abaixo um modelo de uso de containers usando **Docker** e **Docker Compose**, que atrav√©s do manifesto **docker-compose.yml** constr√≥i um ambiente para usou ou laborat√≥rio com containers **MariaDB**, **PHP MyAdmin**, **NGINX** + **PHP_PFM**, utilizando arquivo **.env** com lista de vari√°veis de ambiente.


<hr>

**>> docker-compose.yml**
```yaml
version: '3.9'
services:
    mariadb:
        image: 'mariadb:${MARIADB_VERSION}'
        ports:
            - "${MYSQL_PORT}:3306"
        working_dir: /app
        volumes:
            - ./app/db:/var/lib/mysql
            - ./table.sql:/docker-entrypoint-initdb.d/table.sql
        environment:
            MYSQL_ROOT_PASSWORD: "${MYSQL_ROOT_PASSWORD}"
            MYSQL_DATABASE: "${MYSQL_DATABASE}"
            MYSQL_USER: "${MYSQL_USER}"
            MYSQL_PASSWORD: "${MYSQL_PASSWORD}"

    phpmyadmin:
        image: phpmyadmin/phpmyadmin
        ports:
            - "${PORT_PMA}:80"
        environment:
            PMA_HOST: ${PMA_HOST}
            PMA_PORT: ${PMA_PORT}
            PMA_USER: ${PMA_USER}
            PMA_PASSWORD: ${PMA_PASSWORD}
        depends_on:
            - mariadb

    webserver:
        image: 'nginx:alpine'
        working_dir: /app
        volumes:
            - '.:/app'
            - './phpdocker/nginx/nginx.conf:/etc/nginx/conf.d/default.conf'
        ports:
            - '${PORT_WEB}:80'

    php-fpm:
        build: "${PHP_PFM}"
        working_dir: /app
        volumes:
            - '.:/app'
            - './phpdocker/php-fpm/php-ini-overrides.ini:/etc/php/8.2/fpm/conf.d/99-overrides.ini'

```
**>> .env**
```yaml
PORT_WEB=9010
PORT_PMA=9011
MYSQL_PORT=9012

MARIADB_VERSION=10.6
MYSQL_ROOT_PASSWORD=secret
MYSQL_DATABASE=labphp8-db
MYSQL_USER=labphp8
MYSQL_PASSWORD=secret

PMA_HOST=mariadb
PMA_PORT=3306
PMA_USER=labphp8
PMA_PASSWORD="secret"

PHP_PFM=phpdocker/php-fpm

```
Na pasta **phpdocker** ficam outros arquivos de configura√ß√£o como **Dockerfile** do **PHP_PFM**
```bash
phpdocker
|  |
|  | --> nginx
|        |--> nginx.conf
|
| --> php-fpm
      |--> Dockerfile
      |--> php-ini-overrides.ini

```

### **Para carregar um arquivo diretamente no banco de dados MariaDB:**
Ex.: 
Arquivo `table.sql` ·∫Ω montado como um volume em:

**docker-compose.yml:**
```yaml
version: '3.9'
services:
    mariadb:
        ....
        volumes:
            - ./app/db:/var/lib/mysql
            - ./table.sql:/docker-entrypoint-initdb.d/table.sql
        .....
```

Quando voc√™ executar `docker-compose up`, ele montar√° o arquivo `table.sql` como um volume e o copiar√° para o diret√≥rio `/docker-entrypoint-initdb.d/` dentro do cont√™iner MariaDB. O MariaDB executar√° automaticamente todos os arquivos SQL nesse diret√≥rio ao inicializar o banco de dados.

Certifique-se de ter o arquivo `table.sql` no mesmo diret√≥rio em que est√° o arquivo `docker-compose.yml`. Em seguida, voc√™ pode executar `docker-compose up` para iniciar o cont√™iner MariaDB com o arquivo SQL sendo executado automaticamente.


<hr>

*****

### **Para rodar execute:**

`docker compose up -d` 

ou 

`docker-compose up -d ` 

<i>(dependendo da sua vers√£o do **Docker  Compose**)</i>

<hr>

********

*************
### **Comandos B√£sicos de Docker:**

```
docker run (executar novo container)

docker ps (lista todos os containers rodando)

docker ps -a (demonstra todos os containers, at√© os parados)

docker run ubuntu bash (roda container com Ubuntu e j√° abre o terminal)

docker run -it ubuntu bash (roda imagem de modo interativo)

crtl + d (sair do cont√™iner/bash)

docker run nginx (roda imagem do nginx na porta 80 do cont√™iner, n√£o do computador)

docker run -p 8080:80 nginx (roda a imagem nginx com o cont√™iner publicado na porta 8080 do computador)

docker exec [nome do container] ls (lista diret√≥rios dentro do container devido ao comando exec)

docker run -p 8080:80 -v [diret√≥rio pasta compartilhada] (mesmo derrubando o container, os arquivos de desenvolvimento n√£o s√£o perdidos)

dockerfile (criar sua pr√≥pria imagem)

docker build -t [usuario]/[imagem]:latest
```